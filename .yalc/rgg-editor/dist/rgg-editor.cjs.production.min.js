"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n,t=require("react"),o=e(t),r=require("@stitches/react"),i=require("react-icons/fa"),a=require("@atlaskit/tree"),l=e(a),u=e(require("zustand")),c=require("zustand/middleware"),s=require("valtio"),d=require("lodash-es"),p=e(require("hotkeys-js")),m=require("@dimforge/rapier3d-compat"),f=require("three"),h=require("rgg-engine"),v=require("@react-three/drei"),y=require("react-three-fiber"),g=require("shortcuts"),E=e(require("react-google-font-loader")),b=e(require("react-outside-click-handler")),w=require("react-icons/bi");function C(){return(C=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}function x(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n.indexOf(t=i[o])>=0||(r[t]=e[t]);return r}function M(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof n?n:String(n)}var P=r.createStyled({tokens:{colors:{$darkGrey:"#0c0c0c",$darkGreyLighter:"#161617",$white:"white",$lightPurple:"#9494b7",$faint:"#22222b",$purple:"#3e3ca2",$faintPurple:"#56566f",$midPurple:"#636380",$darkPurple:"#212052",$pink:"#d72859"},sizes:{$sidebar:"220px",$sidebarPlus:"260px",$headerHeight:"42px"},space:{$0b:"2px",$1:"4px",$1b:"6px",$2:"8px",$2b:"12px",$3:"16px"},fonts:{$main:"Roboto, sans-serif"},fontSizes:{$1:"10px",$1b:"12px",$2:"14px",$3:"18px",$4:"22px"},fontWeights:{$regular:"400",$semi:"500",$medium:"600",$bold:"700"},radii:{$1:"3px",$2:"6px"},zIndices:{$high:"9999999",$max:"99999999999"}}}),S=P.styled;P.css.global(((n={})["*, *:before, *:after"]={margin:0,padding:0,boxSizing:"border-box",maxWidth:"100%"},n));var I,k=S("div",{}),T=S("input",{appearance:"none",backgroundColor:"$darkGreyLighter",border:"1px solid $faintPurple",color:"$lightPurple",width:"100%",padding:"$1b",fontSize:"$1b",":focus":{backgroundColor:"$darkGrey",color:"$white"}}),$=/\(([0-9+\-*/^ .]+)\)/,z=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,O=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,L=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,j=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,R=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/,D=S("div",{}),F=function(e){var n=e.inputId,r=e.value,i=e.onChange,a=t.useState(null!=r?r:0),l=a[0],u=a[1];t.useEffect((function(){u(null!=r?r:0)}),[r]);var c=t.useMemo((function(){return{onChange:function(e){var n=function(e){if("number"==typeof e)return e;try{var n=function e(n){if(isNaN(Number(n))){if($.test(n)){var t=n.replace($,(function(n,t){return String(e(t))}));return e(t)}if(z.test(n)){var o=n.replace(z,(function(e,n,t){return String(Math.pow(Number(n),Number(t)))}));return e(o)}if(O.test(n)){var r=n.replace(O,(function(e,n,t){return String(Number(n)*Number(t))}));return e(r)}if(L.test(n)){var i=n.replace(L,(function(e,n,t){if(0!=t)return String(Number(n)/Number(t));throw new Error("Division by zero")}));return e(i)}if(j.test(n)){var a=n.replace(j,(function(e,n,t){return String(Number(n)+Number(t))}));return e(a)}if(R.test(n)){var l=n.replace(R,(function(e,n,t){return String(Number(n)-Number(t))}));return e(l)}return Number(n)}return Number(n)}(e);if(!isNaN(n))return n}catch(e){}return parseFloat(e)}(e.target.value);u(n),i(n)}}}),[i]);return o.createElement(D,null,o.createElement(T,{id:n,type:"number",value:l,onChange:c.onChange}))},A={input:function(e){var n=e.inputId,r=e.value,i=e.onChange,a=t.useState(null!=r?r:""),l=a[0],u=a[1];t.useEffect((function(){u(null!=r?r:"")}),[r]);var c=t.useMemo((function(){return{onChange:function(e){var n=e.target.value;u(n),i(n)}}}),[i]);return o.createElement(k,null,o.createElement(T,{id:n,type:"text",value:l,onChange:c.onChange}))}},Y={input:F},G=function(e){var n=t.useState((function(){return"number"==typeof e.value?Y.input:A.input}));return o.createElement(n[0],Object.assign({},e))},B=S("div",{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr)",columnGap:"$2b"}),X=S("div",{display:"grid",alignItems:"center",columnGap:"$1b",gridTemplateColumns:"auto minmax(0, 1fr)"}),Z=S("label",{fontSize:"$1b"}),V=function(e){var n=e.inputId,t=e.value,r=e.onChange;return o.createElement(B,null,Object.entries(t).map((function(e,i){var a=e[0],l=e[1],u=0===i?n:n+"/"+a;return o.createElement(X,{key:a},o.createElement(Z,{htmlFor:u},a),o.createElement(G,{inputId:u,value:l,onChange:function(e){var n;r(C({},t,((n={})[a]=e,n)))}}))})))},Q={componentNames:{},components:{},sharedComponents:{},selectedComponents:{},componentsTree:{},unsavedComponents:{},deactivatedComponents:{},groups:{},groupedComponents:{}},N=u(c.persist((function(){return Q}),{name:"mainStateStore",onRehydrateStorage:function(){return function(e){}},version:5,blacklist:[]})),q=N.setState,_=N.getState,W=0,U=function(){return W+=1,(Date.now()+W).toString()},H=function(e){return e.join("/")};!function(e){e.translate="translate",e.rotate="rotate",e.scale="scale"}(I||(I={}));var K,J=s.proxy({editMode:!1,transformMode:I.translate,groupPortalRef:null,orbitRef:null,selectedRef:null,cameraCanvasRef:null,mainCamera:null,transformActive:!1,addComponentKey:"",movingComponents:[],addComponentPosition:{x:0,y:0,z:0}}),ee=function(){return s.useProxy(J).editMode},ne=function(){return s.useProxy(J).transformMode},te=function(e){J.transformMode=e};!function(e){e.COMPONENTS="COMPONENTS"}(K||(K={}));var oe,re=s.proxy({pendingPaste:null}),ie=function(){return _().selectedComponents},ae=u(c.persist((function(){return{pastSnapshots:[],futureSnapshots:[]}}),{name:"historyStore",version:1})),le=function(){ae.setState((function(e){var n=e.pastSnapshots.concat([N.getState()]);return n.length>20&&n.shift(),{pastSnapshots:n,futureSnapshots:[]}}))},ue=function(){var e=ae.getState().pastSnapshots,n=e[e.length-1];if(n){var t=N.getState();N.setState(n),ae.setState((function(n){return{pastSnapshots:e.slice(0,e.length-1),futureSnapshots:n.futureSnapshots.concat([t])}}))}},ce=function(){var e=ae.getState().futureSnapshots,n=e[e.length-1];if(n){var t=N.getState();N.setState(n),ae.setState((function(n){return{futureSnapshots:e.slice(0,e.length-1),pastSnapshots:n.pastSnapshots.concat([t])}}))}},se=function(e,n,t){q((function(o){var r,i,a,l,u=null!=(r=o.components[e])?r:{},c=t;if("function"==typeof t){var s=u.modifiedState,d=(void 0===s?{}:s)[n];c=t((void 0===d?{value:void 0}:d).value)}return(u=C({},u,{modifiedState:C({},null!=(i=u.modifiedState)?i:{},(a={},a[n]={value:c},a))})).overriddenState&&u.overriddenState[n]&&delete u.overriddenState[n],{components:C({},o.components,(l={},l[e]=u,l))}}))},de=function(e,n){void 0===n&&(n=!0),q((function(t){return{selectedComponents:n?e:C({},t.selectedComponents,e)}}))},pe=function(e,n){q((function(t){var o,r;return{componentsTree:C({},t.componentsTree,(r={},r[e]=C({},null!=(o=t.componentsTree[e])?o:{children:[]},{isExpanded:n}),r))}}))},me=function(e){var n=_();n.groups[e]?function(e){var n,t,o;(n=e,t=_(),o=[],Object.entries(t.groupedComponents).forEach((function(e){e[1]===n&&o.push(e[0])})),o).forEach((function(e){me(e)})),q((function(n){var t=C({},n.groups);return delete t[e],{groups:t}}))}(e):n.unsavedComponents[e]?he(e):ve(e)},fe=function(){le();var e=_().selectedComponents;Object.keys(e).forEach((function(e){me(e)}))},he=function(e){q((function(n){var t=C({},n.unsavedComponents);return delete t[e],{unsavedComponents:t}}))},ve=function(e){q((function(n){var t;return{deactivatedComponents:C({},n.deactivatedComponents,(t={},t[e]=!0,t))}}))},ye=function(e,n){var t=!0,o="",r=_().groupedComponents;e.forEach((function(e){var n=r[e];n&&(o&&o!==n?t=!1:o=n)})),q((function(r){var i,a,l,u={groupedComponents:C({},null!=(i=r.groupedComponents)?i:{})};return n||(n=U(),u.groups=C({},null!=(a=r.groups)?a:{},((l={})[n]={name:"Group",isExpanded:!0},l))),t&&(u.groupedComponents[n]=o),e.forEach((function(e){u.groupedComponents[e]=n})),u}))},ge=function(){return N((function(e){return e.selectedComponents}))},Ee=function(e){var n;return null!=(n=N((function(n){var t;return null==(t=n.componentNames[e])?void 0:t.name})))?n:""},be=u((function(){return{components:{},deactivatedComponents:{},componentsThatCanHaveChildren:{}}})),we=function(e){return be((function(n){return n.components[e]}))},Ce=function(){var e;return null!=(e=p.command||p.cmd||p.control)&&e},xe=function(){var e;return null!=(e=p.shift)&&e};!function(e){e.modified="modified",e.initial="initial",e.applied="applied",e.default="default"}(oe||(oe={}));var Me=u((function(){return{components:{}}})),Pe=function(e,n){Me.setState((function(t){var o,r;return{components:C({},t.components,(r={},r[e]=n(null!=(o=t.components[e])?o:{}),r))}}))},Se=function(e){switch(e){case Un.STATIC:return m.BodyStatus.Static;case Un.KINEMATIC:return m.BodyStatus.Kinematic;default:return m.BodyStatus.Dynamic}},Ie=function(e){var n,o=e.value,r=e.meshRef,i=qe(),a=Ze().setSharedProp,l=null!=(n=We(Pt.rotation))?n:{x:0,y:0,z:0},u=l.x,c=l.y,s=l.z;h.useRapier3DBody((function(){var e=r.current.position;return function(e,n,t){var o,r,i;void 0===t&&(t=[0,0,0]);var a=function(e){void 0===e&&(e=[]);var n=[];return e.forEach((function(e){n.push(function(e){switch(e.colliderType){case Wn.BALL:var n=e.radius;return{type:"Ball",args:[void 0===n?1:n]};default:var t=e.hx,o=e.hy,r=e.hz;return{type:"Cubiod",args:[void 0===t?.5:t,void 0===o?.5:o,void 0===r?.5:r]}}}(e))})),n}(e.colliders),l=null!=(o=e.mass)?o:1,u=function(e,n,t){var o=new f.Euler(e,n,t),r=new f.Quaternion;return r.setFromEuler(o),r}(t[0],t[1],t[2]),c=null!=(r=null==(i=e.customBodyDef)?void 0:i.customBody)?r:"";return{body:{type:Se(e.bodyType),position:n,quaternion:[u.x,u.y,u.z,u.w],mass:l},colliders:a,customBody:c}}(o,[e.x,e.y,e.z],[u,c,s])}),{ref:r,id:i});var d=h.useBodyApi(i);return t.useEffect((function(){a("rigidBody3dApi",d)}),[d]),null},ke=function(e){var n=e.collider;if(n.colliderType===Wn.BALL){var t=n.radius;return o.createElement(v.Sphere,{args:[(void 0===t?1:t)+.001],layers:[31]},o.createElement("meshPhongMaterial",{color:"red",wireframe:!0}))}if(n.colliderType===Wn.CUBIOD){var r=n.hx,i=n.hy,a=n.hz;return o.createElement(v.Box,{args:[2*(void 0===r?.5:r),2*(void 0===i?.5:i),2*(void 0===a?.5:a)],layers:[31]},o.createElement("meshPhongMaterial",{color:"red",wireframe:!0}))}return null},Te=function(e){var n,t=e.visible,r=e.value.colliders,i=void 0===r?[]:r,a=null!=(n=We(Pt.scale))?n:{x:1,y:1,z:1};return o.createElement("group",{visible:t,scale:[1/a.x,1/a.y,1/a.z]},i.map((function(e){return o.createElement(ke,{collider:e,key:e.key})})))},$e=function(e){var n=e.value,t=Ve("meshRef"),r=ee();return t&&n.enabled?o.createElement(o.Fragment,null,!r&&o.createElement(Ie,{meshRef:t,value:n}),o.createElement(Te,{value:n,visible:r})):null},ze=function(e){var n=e.children;We(gt.key);var t=We(Pt.rigidBody3d);return o.createElement(o.Fragment,null,n,t&&o.createElement($e,{value:t}))},Oe=function(e,n){void 0===n&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),f.Object3D.call(this),this.visible=!1,this.domElement=n;var t=new Le;this.add(t);var o=new je;this.add(o);var r=this;B("camera",e),B("object",void 0),B("enabled",!0),B("axis",null),B("mode","translate"),B("translationSnap",null),B("rotationSnap",null),B("scaleSnap",null),B("space","world"),B("size",1),B("dragging",!1),B("showX",!0),B("showY",!0),B("showZ",!0);var i={type:"change"},a={type:"mouseDown"},l={type:"mouseUp",mode:r.mode},u={type:"objectChange"},c=new f.Raycaster;function s(e,n,t){for(var o=n.intersectObject(e,!0),r=0;r<o.length;r++)if(o[r].object.visible||t)return o[r];return!1}this.raycaster=c;var d=new f.Vector3,p=new f.Vector3,m=new f.Quaternion,h={X:new f.Vector3(1,0,0),Y:new f.Vector3(0,1,0),Z:new f.Vector3(0,0,1)},v=new f.Vector3,y=new f.Vector3,g=new f.Vector3,E=new f.Vector3,b=new f.Vector3,w=new f.Vector3,C=0,x=new f.Vector3,M=new f.Quaternion,P=new f.Vector3,S=new f.Vector3,I=new f.Quaternion,k=new f.Quaternion,T=new f.Vector3,$=new f.Vector3,z=new f.Quaternion,O=new f.Vector3,L=new f.Vector3,j=new f.Quaternion,R=new f.Quaternion,D=new f.Vector3,F=new f.Vector3,A=new f.Vector3,Y=new f.Quaternion,G=new f.Vector3;function B(e,n){var a=n;Object.defineProperty(r,e,{get:function(){return void 0!==a?a:n},set:function(n){a!==n&&(a=n,o[e]=n,t[e]=n,r.dispatchEvent({type:e+"-changed",value:n}),r.dispatchEvent(i))}}),r[e]=n,o[e]=n,t[e]=n}function X(e){if(r.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};var t=e.changedTouches?e.changedTouches[0]:e,o=n.getBoundingClientRect();return{x:(t.clientX-o.left)/o.width*2-1,y:-(t.clientY-o.top)/o.height*2+1,button:e.button}}function Z(e){if(r.enabled)switch(e.pointerType){case"mouse":case"pen":r.pointerHover(X(e))}}function V(e){r.enabled&&(r.domElement.style.touchAction="none",r.domElement.ownerDocument.addEventListener("pointermove",Q),r.pointerHover(X(e)),r.pointerDown(X(e)))}function Q(e){r.enabled&&r.pointerMove(X(e))}function N(e){r.enabled&&(r.domElement.style.touchAction="",r.domElement.ownerDocument.removeEventListener("pointermove",Q),r.pointerUp(X(e)))}B("worldPosition",L),B("worldPositionStart",$),B("worldQuaternion",j),B("worldQuaternionStart",z),B("cameraPosition",x),B("cameraQuaternion",M),B("pointStart",v),B("pointEnd",y),B("rotationAxis",E),B("rotationAngle",C),B("eye",F),n.addEventListener("pointerdown",V),n.addEventListener("pointermove",Z),r.domElement.ownerDocument.addEventListener("pointerup",N),this.dispose=function(){n.removeEventListener("pointerdown",V),n.removeEventListener("pointermove",Z),r.domElement.ownerDocument.removeEventListener("pointermove",Q),r.domElement.ownerDocument.removeEventListener("pointerup",N),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(S,I,T),this.object.matrixWorld.decompose(L,j,D),k.copy(I).invert(),R.copy(j).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(x,M,P),F.copy(x).sub(L).normalize(),f.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging){c.setFromCamera(e,this.camera);var n=s(t.picker[this.mode],c);this.axis=n?n.object.name:null}},this.pointerDown=function(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){c.setFromCamera(e,this.camera);var n=s(o,c,!0);if(n){var t=this.space;if("scale"===this.mode?t="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(t="world"),"local"===t&&"rotate"===this.mode){var r=this.rotationSnap;"X"===this.axis&&r&&(this.object.rotation.x=Math.round(this.object.rotation.x/r)*r),"Y"===this.axis&&r&&(this.object.rotation.y=Math.round(this.object.rotation.y/r)*r),"Z"===this.axis&&r&&(this.object.rotation.z=Math.round(this.object.rotation.z/r)*r)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),A.copy(this.object.position),Y.copy(this.object.quaternion),G.copy(this.object.scale),this.object.matrixWorld.decompose($,z,O),v.copy(n.point).sub($)}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var n=this.axis,t=this.mode,r=this.object,a=this.space;if("scale"===t?a="local":"E"!==n&&"XYZE"!==n&&"XYZ"!==n||(a="world"),void 0!==r&&null!==n&&!1!==this.dragging&&-1===e.button){c.setFromCamera(e,this.camera);var l=s(o,c,!0);if(l){if(y.copy(l.point).sub($),"translate"===t)g.copy(y).sub(v),"local"===a&&"XYZ"!==n&&g.applyQuaternion(R),-1===n.indexOf("X")&&(g.x=0),-1===n.indexOf("Y")&&(g.y=0),-1===n.indexOf("Z")&&(g.z=0),"local"===a&&"XYZ"!==n?g.applyQuaternion(Y).divide(T):g.applyQuaternion(k).divide(T),r.position.copy(g).add(A),this.translationSnap&&("local"===a&&(r.position.applyQuaternion(m.copy(Y).invert()),-1!==n.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==n.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==n.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(Y)),"world"===a&&(r.parent&&r.position.add(d.setFromMatrixPosition(r.parent.matrixWorld)),-1!==n.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==n.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==n.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(d.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===t){if(-1!==n.search("XYZ")){var f=y.length()/v.length();y.dot(v)<0&&(f*=-1),p.set(f,f,f)}else d.copy(v),p.copy(y),d.applyQuaternion(R),p.applyQuaternion(R),p.divide(d),-1===n.search("X")&&(p.x=1),-1===n.search("Y")&&(p.y=1),-1===n.search("Z")&&(p.z=1);r.scale.copy(G).multiply(p),this.scaleSnap&&(-1!==n.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==n.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==n.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===t){g.copy(y).sub(v);var x=20/L.distanceTo(d.setFromMatrixPosition(this.camera.matrixWorld));"E"===n?(E.copy(F),C=y.angleTo(v),b.copy(v).normalize(),w.copy(y).normalize(),C*=w.cross(b).dot(F)<0?1:-1):"XYZE"===n?(E.copy(g).cross(F).normalize(),C=g.dot(d.copy(E).cross(this.eye))*x):"X"!==n&&"Y"!==n&&"Z"!==n||(E.copy(h[n]),d.copy(h[n]),"local"===a&&d.applyQuaternion(j),C=g.dot(d.cross(F).normalize())*x),this.rotationSnap&&(C=Math.round(C/this.rotationSnap)*this.rotationSnap),this.rotationAngle=C,"local"===a&&"E"!==n&&"XYZE"!==n?(r.quaternion.copy(Y),r.quaternion.multiply(m.setFromAxisAngle(E,C)).normalize()):(E.applyQuaternion(k),r.quaternion.copy(m.setFromAxisAngle(E,C)),r.quaternion.multiply(Y).normalize())}this.dispatchEvent(i),this.dispatchEvent(u)}}},this.pointerUp=function(e){0===e.button&&(this.dragging&&null!==this.axis&&(l.mode=this.mode,this.dispatchEvent(l)),this.dragging=!1,this.axis=null)},this.getMode=function(){return r.mode},this.setMode=function(e){r.mode=e},this.setTranslationSnap=function(e){r.translationSnap=e},this.setRotationSnap=function(e){r.rotationSnap=e},this.setScaleSnap=function(e){r.scaleSnap=e},this.setSize=function(e){r.size=e},this.setSpace=function(e){r.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};Oe.prototype=Object.assign(Object.create(f.Object3D.prototype),{constructor:Oe,isTransformControls:!0});var Le=function(){f.Object3D.call(this),this.type="TransformControlsGizmo";var e=new f.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:f.DoubleSide,fog:!1,toneMapped:!1}),n=new f.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),t=e.clone();t.opacity=.15;var o=e.clone();o.opacity=.33;var r=e.clone();r.color.set(16711680);var i=e.clone();i.color.set(65280);var a=e.clone();a.color.set(255);var l=e.clone();l.opacity=.25;var u=l.clone();u.color.set(16776960);var c=l.clone();c.color.set(65535);var s=l.clone();s.color.set(16711935),e.clone().color.set(16776960);var d=n.clone();d.color.set(16711680);var p=n.clone();p.color.set(65280);var m=n.clone();m.color.set(255);var h=n.clone();h.color.set(65535);var v=n.clone();v.color.set(16711935);var y=n.clone();y.color.set(16776960);var g=n.clone();g.color.set(7895160);var E=y.clone();E.opacity=.25;var b=new f.CylinderGeometry(0,.05,.2,12,1,!1),w=new f.BoxGeometry(.125,.125,.125),C=new f.BufferGeometry;C.setAttribute("position",new f.Float32BufferAttribute([0,0,0,1,0,0],3));var x,M=function(e,n){for(var t=new f.BufferGeometry,o=[],r=0;r<=64*n;++r)o.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return t.setAttribute("position",new f.Float32BufferAttribute(o,3)),t},P={X:[[new f.Mesh(b,r),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new f.Mesh(b,r),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new f.Line(C,d)]],Y:[[new f.Mesh(b,i),[0,1,0],null,null,"fwd"],[new f.Mesh(b,i),[0,1,0],[Math.PI,0,0],null,"bwd"],[new f.Line(C,p),null,[0,0,Math.PI/2]]],Z:[[new f.Mesh(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new f.Mesh(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new f.Line(C,m),null,[0,-Math.PI/2,0]]],XYZ:[[new f.Mesh(new f.OctahedronGeometry(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new f.Mesh(new f.PlaneGeometry(.295,.295),u.clone()),[.15,.15,0]],[new f.Line(C,y),[.18,.3,0],null,[.125,1,1]],[new f.Line(C,y),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new f.Mesh(new f.PlaneGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new f.Line(C,h),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new f.Line(C,h),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new f.Mesh(new f.PlaneGeometry(.295,.295),s.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new f.Line(C,v),[.18,0,.3],null,[.125,1,1]],[new f.Line(C,v),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new f.Mesh(new f.CylinderGeometry(.2,0,1,4,1,!1),t),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new f.Mesh(new f.CylinderGeometry(.2,0,1,4,1,!1),t),[0,.6,0]]],Z:[[new f.Mesh(new f.CylinderGeometry(.2,0,1,4,1,!1),t),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new f.Mesh(new f.OctahedronGeometry(.2,0),t)]],XY:[[new f.Mesh(new f.PlaneGeometry(.4,.4),t),[.2,.2,0]]],YZ:[[new f.Mesh(new f.PlaneGeometry(.4,.4),t),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new f.Mesh(new f.PlaneGeometry(.4,.4),t),[.2,0,.2],[-Math.PI/2,0,0]]]},I={START:[[new f.Mesh(new f.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new f.Mesh(new f.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new f.Line((x=new f.BufferGeometry,x.setAttribute("position",new f.Float32BufferAttribute([0,0,0,1,1,1],3)),x),o),null,null,null,"helper"]],X:[[new f.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new f.Line(C,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new f.Line(C,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k={X:[[new f.Line(M(1,.5),d)],[new f.Mesh(new f.OctahedronGeometry(.04,0),r),[0,0,.99],null,[1,3,1]]],Y:[[new f.Line(M(1,.5),p),null,[0,0,-Math.PI/2]],[new f.Mesh(new f.OctahedronGeometry(.04,0),i),[0,0,.99],null,[3,1,1]]],Z:[[new f.Line(M(1,.5),m),null,[0,Math.PI/2,0]],[new f.Mesh(new f.OctahedronGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new f.Line(M(1.25,1),E),null,[0,Math.PI/2,0]],[new f.Mesh(new f.CylinderGeometry(.03,0,.15,4,1,!1),E),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new f.Mesh(new f.CylinderGeometry(.03,0,.15,4,1,!1),E),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new f.Mesh(new f.CylinderGeometry(.03,0,.15,4,1,!1),E),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new f.Mesh(new f.CylinderGeometry(.03,0,.15,4,1,!1),E),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new f.Line(M(1,1),g),null,[0,Math.PI/2,0]]]},T={AXIS:[[new f.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},$={X:[[new f.Mesh(new f.TorusGeometry(1,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new f.Mesh(new f.TorusGeometry(1,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]]],Z:[[new f.Mesh(new f.TorusGeometry(1,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]]],E:[[new f.Mesh(new f.TorusGeometry(1.25,.1,2,24),t)]],XYZE:[[new f.Mesh(new f.SphereGeometry(.7,10,8),t)]]},z={X:[[new f.Mesh(w,r),[.8,0,0],[0,0,-Math.PI/2]],[new f.Line(C,d),null,null,[.8,1,1]]],Y:[[new f.Mesh(w,i),[0,.8,0]],[new f.Line(C,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new f.Mesh(w,a),[0,0,.8],[Math.PI/2,0,0]],[new f.Line(C,m),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new f.Mesh(w,u),[.85,.85,0],null,[2,2,.2]],[new f.Line(C,y),[.855,.98,0],null,[.125,1,1]],[new f.Line(C,y),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new f.Mesh(w,c),[0,.85,.85],null,[.2,2,2]],[new f.Line(C,h),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new f.Line(C,h),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new f.Mesh(w,s),[.85,0,.85],null,[2,.2,2]],[new f.Line(C,v),[.855,0,.98],null,[.125,1,1]],[new f.Line(C,v),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new f.Mesh(new f.BoxGeometry(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new f.Mesh(new f.BoxGeometry(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new f.Mesh(new f.BoxGeometry(.125,.125,.125),l.clone()),[0,0,1.1]]]},O={X:[[new f.Mesh(new f.CylinderGeometry(.2,0,.8,4,1,!1),t),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new f.Mesh(new f.CylinderGeometry(.2,0,.8,4,1,!1),t),[0,.5,0]]],Z:[[new f.Mesh(new f.CylinderGeometry(.2,0,.8,4,1,!1),t),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new f.Mesh(w,t),[.85,.85,0],null,[3,3,.2]]],YZ:[[new f.Mesh(w,t),[0,.85,.85],null,[.2,3,3]]],XZ:[[new f.Mesh(w,t),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new f.Mesh(new f.BoxGeometry(.2,.2,.2),t),[1.1,0,0]]],XYZY:[[new f.Mesh(new f.BoxGeometry(.2,.2,.2),t),[0,1.1,0]]],XYZZ:[[new f.Mesh(new f.BoxGeometry(.2,.2,.2),t),[0,0,1.1]]]},L={X:[[new f.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new f.Line(C,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new f.Line(C,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j=function(e){var n=new f.Object3D;for(var t in e)for(var o=e[t].length;o--;){var r=e[t][o][0].clone(),i=e[t][o][1],a=e[t][o][2],l=e[t][o][3],u=e[t][o][4];r.name=t,r.tag=u,i&&r.position.set(i[0],i[1],i[2]),a&&r.rotation.set(a[0],a[1],a[2]),l&&r.scale.set(l[0],l[1],l[2]),r.updateMatrix();var c=r.geometry.clone();c.applyMatrix4(r.matrix),r.geometry=c,r.renderOrder=Infinity,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),n.add(r)}return n},R=new f.Vector3(0,0,0),D=new f.Euler,F=new f.Vector3(0,1,0),A=new f.Vector3(0,0,0),Y=new f.Matrix4,G=new f.Quaternion,B=new f.Quaternion,X=new f.Quaternion,Z=new f.Vector3(1,0,0),V=new f.Vector3(0,1,0),Q=new f.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(P)),this.add(this.gizmo.rotate=j(k)),this.add(this.gizmo.scale=j(z)),this.add(this.picker.translate=j(S)),this.add(this.picker.rotate=j($)),this.add(this.picker.scale=j(O)),this.add(this.helper.translate=j(I)),this.add(this.helper.rotate=j(T)),this.add(this.helper.scale=j(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var n="local"===e?this.worldQuaternion:X;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var t=[];t=(t=(t=t.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var o=0;o<t.length;o++){var r,i=t[o];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==i.tag?(i.quaternion.copy(n),"translate"===this.mode||"scale"===this.mode?("X"!==i.name&&"XYZX"!==i.name||Math.abs(F.copy(Z).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(F.copy(V).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(F.copy(Q).applyQuaternion(n).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(F.copy(Q).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(F.copy(Z).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(F.copy(V).applyQuaternion(n).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(F.copy(Z).applyQuaternion(n).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(F.copy(V).applyQuaternion(n).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(F.copy(Q).applyQuaternion(n).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))):"rotate"===this.mode&&(B.copy(n),F.copy(this.eye).applyQuaternion(G.copy(n).invert()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(Y.lookAt(this.eye,A,V)),"X"===i.name&&(G.setFromAxisAngle(Z,Math.atan2(-F.y,F.z)),G.multiplyQuaternions(B,G),i.quaternion.copy(G)),"Y"===i.name&&(G.setFromAxisAngle(V,Math.atan2(F.x,F.z)),G.multiplyQuaternions(B,G),i.quaternion.copy(G)),"Z"===i.name&&(G.setFromAxisAngle(Q,Math.atan2(F.y,F.x)),G.multiplyQuaternions(B,G),i.quaternion.copy(G))),i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis||this.axis.split("").some((function(e){return i.name===e}))?(i.material.opacity=1,i.material.color.lerp(new f.Color(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new f.Color(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new f.Color(1,1,1),.5))):(i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(G.setFromEuler(D.set(0,0,0)),i.quaternion.copy(n).multiply(G),Math.abs(F.copy(Z).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(G.setFromEuler(D.set(0,0,Math.PI/2)),i.quaternion.copy(n).multiply(G),Math.abs(F.copy(V).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(G.setFromEuler(D.set(0,Math.PI/2,0)),i.quaternion.copy(n).multiply(G),Math.abs(F.copy(Q).applyQuaternion(n).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(G.setFromEuler(D.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(Y.lookAt(A,F,V)),i.quaternion.multiply(G),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),R.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),R.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(R),i.visible=this.dragging):(i.quaternion.copy(n),i.position.copy(this.dragging?this.worldPositionStart:this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name))))}f.Object3D.prototype.updateMatrixWorld.call(this)}};Le.prototype=Object.assign(Object.create(f.Object3D.prototype),{constructor:Le,isTransformControlsGizmo:!0});var je=function(){f.Mesh.call(this,new f.PlaneGeometry(1e5,1e5,2,2),new f.MeshBasicMaterial({visible:!1,wireframe:!0,side:f.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var e=new f.Vector3(1,0,0),n=new f.Vector3(0,1,0),t=new f.Vector3(0,0,1),o=new f.Vector3,r=new f.Vector3,i=new f.Vector3,a=new f.Matrix4,l=new f.Quaternion;this.updateMatrixWorld=function(){var u=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(u="local"),e.set(1,0,0).applyQuaternion("local"===u?this.worldQuaternion:l),n.set(0,1,0).applyQuaternion("local"===u?this.worldQuaternion:l),t.set(0,0,1).applyQuaternion("local"===u?this.worldQuaternion:l),i.copy(n),this.mode){case"translate":case"scale":switch(this.axis){case"X":i.copy(this.eye).cross(e),r.copy(e).cross(i);break;case"Y":i.copy(this.eye).cross(n),r.copy(n).cross(i);break;case"Z":i.copy(this.eye).cross(t),r.copy(t).cross(i);break;case"XY":r.copy(t);break;case"YZ":r.copy(e);break;case"XZ":i.copy(t),r.copy(n);break;case"XYZ":case"E":r.set(0,0,0)}break;case"rotate":default:r.set(0,0,0)}0===r.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(o.set(0,0,0),r,i),this.quaternion.setFromRotationMatrix(a)),f.Object3D.prototype.updateMatrixWorld.call(this)}};je.prototype=Object.assign(Object.create(f.Mesh.prototype),{constructor:je,isTransformControlsPlane:!0});var Re=function(e,n,o){t.useEffect((function(){return o?p(e,o,n):p(e,n),function(){p.unbind(e,n)}}),[])},De=function(e,n){var o=t.useCallback(e,n),r=t.useRef(o);return t.useEffect((function(){r.current=o}),[o]),r},Fe=Oe,Ae=function(e,n,o){var r;void 0===o&&(o={});var i=y.useThree(),a=i.camera,l=i.gl,u=i.scene,c=ee(),d=t.useRef(null),p=null!=(r=o.passedRef)?r:d,m=s.useProxy(J).orbitRef,h=t.useState(null),v=h[0],g=h[1],E=t.useState(xe()),b=E[0],w=E[1],C=o.updateValue,x=o.onChange,M=o.onDraggingChanged;Re("*",(function(){w(xe())}),{keyup:!0,keydown:!0}),t.useEffect((function(){var e=function(){w(xe())};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}}),[]);var P=c&&n&&!0;t.useEffect((function(){if(v){var e=v.translationSnap,n=v.rotationSnap;return b?(v.setTranslationSnap(1),v.setRotationSnap(1),function(){v.setTranslationSnap(e),v.setRotationSnap(n)}):void 0}}),[b,v]);var S=t.useRef(new f.Vector3);t.useEffect((function(){if(m&&v){var e=function(e){S.current.copy(p.current.position),J.transformActive=e.value,m.current&&(m.current.enabled=!e.value),M&&M(e)};return v.addEventListener("dragging-changed",e),x&&v.addEventListener("change",x),function(){J.transformActive=!1,m.current&&(m.current.enabled=!0),x&&v.removeEventListener("change",x),v.removeEventListener("dragging-changed",e)}}}),[m,v]);var k=ne(),T=t.useCallback((function(){if(p.current)if(le(),console.log("MOUSE UP!"),k===I.translate){var n=p.current.position,t=n.x,o=n.y,r=n.z;C?C(Pt.position,{x:t,y:o,z:r},S.current):se(e,Pt.position,{x:t,y:o,z:r})}else if(k===I.rotate){var i=p.current.rotation,a=i.x,l=i.y,u=i.z;C?C(Pt.rotation,{x:a,y:l,z:u},S.current):se(e,Pt.rotation,{x:a,y:l,z:u})}else if(k===I.scale){var c=p.current.scale,s=c.x,d=c.y,m=c.z;C?C(Pt.scale,{x:s,y:d,z:m},S.current):se(e,Pt.scale,{x:s,y:d,z:m})}}),[k]),$=t.useRef(T);return t.useEffect((function(){$.current=T}),[T]),t.useEffect((function(){if(P&&p.current){var e=new Fe(a,l.domElement),n=o.translationSnap;return null!=n&&e.setTranslationSnap(n),e.raycaster.layers.enable(Ye),function e(n){n.layers.set(Ye),n.children.forEach((function(n){return e(n)}))}(e),g(e),e.attach(p.current),e.addEventListener("mouseUp",(function(){$.current()})),u.add(e),function(){e.detach(),u.remove(e),g(null)}}}),[P]),t.useEffect((function(){null==v||v.setMode(k)}),[v,k]),[p]},Ye=31,Ge=function(e,n){var o=t.useMemo((function(){return n?f.BoxHelper:null}),[n]),r=v.useHelper(e,o);t.useEffect((function(){var e;r.current&&(null==(e=r.current)||e.layers.set(Ye))}))},Be=function(e){var n=e.children,r=qe(),i=Ze().parentPath,a=Qe(),l=Ne(),u=a&&!l,c=s.useProxy(J).groupPortalRef,d=Ze().setSharedProp;t.useEffect((function(){if(u&&c){var e=x.current.parent;return null==e||e.remove(x.current),c.current.add(x.current),function(){c.current.remove(x.current),null==e||e.add(x.current)}}}),[u,c]);var p=We(Pt.position,{defaultValue:{x:0,y:0,z:0}}),m=We(Pt.rotation,{defaultValue:{x:0,y:0,z:0}}),f=We(Pt.scale,{defaultValue:{x:1,y:1,z:1}}),h=t.useState(!1),v=h[0],y=h[1],g=ee();t.useEffect((function(){if(v)return mn(r)}),[v,r]);var E=t.useMemo((function(){return{onPointerUp:function(e){var n;if(g){var t=!1;if(e.intersections.forEach((function(e){var n=e.eventObject.userData.id;n!==r&&i.includes(n)&&(t=!0)})),!t){e.stopPropagation();var o=xe()||Ce();J.transformActive||de(((n={})[r]=!0,n),!o)}}},onPointerOver:function(e){g&&(e.stopPropagation(),J.transformActive||y(!0))},onPointerOut:function(e){g&&(e.stopPropagation(),y(!1))}}}),[g,i]),b=E.onPointerUp,w=E.onPointerOver,C=E.onPointerOut,x=t.useRef(null);Ge(x,(a||v)&&g),Ae(r,l,{passedRef:x}),t.useEffect((function(){if(l){var e=s.ref(x);return J.selectedRef=e,function(){J.selectedRef===e&&(J.selectedRef=null)}}}),[l]),t.useEffect((function(){d("meshRef",x)}),[d,x]);var M=t.useRef(!0);return t.useEffect((function(){(g||M.current)&&(M.current=!1,x.current.position.set(p.x,p.y,p.z),x.current.rotation.set(m.x,m.y,m.z),x.current.scale.set(f.x,f.y,f.z))}),[g,p,m,f]),o.createElement("group",{ref:x,onPointerUp:b,onPointerOver:w,onPointerOut:C,userData:{id:r}},n)},Xe=t.createContext({id:"",componentTypeId:"",isRoot:!0,parentId:"",rootParentId:"",parentPath:[],registerWithParent:function(){return function(){}},isSelected:{selected:!1},sharedProps:{},setSharedProp:function(){}}),Ze=function(){return t.useContext(Xe)},Ve=function(e){return Ze().sharedProps[e]},Qe=function(){return Ze().isSelected.selected},Ne=function(){var e,n=Ze().isSelected;return null!=(e=n.selected&&n.single)&&e},qe=function(){return Ze().id},_e=function(e){var n,r=e.children,i=e.id,a=e._config,l=void 0===a?{}:a,u=x(e,["children","id","_config"]),c=Ze(),s=c.isRoot,d=c.parentPath,p=c.registerWithParent,m=c.parentId,f=c.rootParentId,h=t.useState((function(){return(null==l?void 0:l.name)||r&&(r.type.displayName||r.type.name)||i}))[0],v=t.useState((function(){return H(d.concat([i]))}))[0],y=t.useState((function(){return function(e){return e.type?e.type:""}(l)}))[0],g=function(e){var n=ge();return t.useMemo((function(){return Object.keys(n).includes(e)?{selected:!0,single:1===Object.keys(n).length}:{selected:!1}}),[e,n])}(v),E=t.useMemo((function(){return g.selected&&g.single}),[g]);t.useEffect((function(){if(E)return function(){Pe(v,(function(){return{}}))}}),[E]),t.useLayoutEffect((function(){p(v)}),[]),t.useLayoutEffect((function(){!function(e,n){be.setState((function(t){var o,r;return t.components[e]?{components:C({},t.components,(r={},r[e]=C({},null!=(o=t.components[e])?o:{},{initialProps:n}),r))}:{}}))}(v,u)}),[u]);var b=t.useState({}),w=b[0],M=b[1],P=t.useMemo((function(){return{registerChildren:function(e){return M((function(n){var t;return C({},n,((t={})[e]=!0,t))})),function(){M((function(n){var t=C({},n);return delete t[e],t}))}}}}),[]).registerChildren,S=function(e){var n;return null!=(n=N((function(n){return n.deactivatedComponents[e]})))&&n}(v),I=null!=(n=l._unsaved)&&n;t.useEffect((function(){return S?(function(e,n,t,o,r,i,a){be.setState((function(l){var u;return{deactivatedComponents:C({},l.deactivatedComponents,(u={},u[e]={uid:e,name:n,children:t,isRoot:o,unsaved:r,parentId:i,rootParentId:a},u))}}))}(v,h,Object.keys(w),s,I,m,f),function(){!function(e){be.setState((function(n){var t=C({},n.deactivatedComponents);return delete t[e],{deactivatedComponents:t}}))}(v)}):(function(e,n,t,o,r,i,a,l,u){void 0===i&&(i={}),be.setState((function(c){var s;return{components:C({},c.components,(s={},s[e]={uid:e,name:n,children:t,isRoot:o,unsaved:r,initialProps:i,componentId:a,parentId:l,rootParentId:u},s))}}))}(v,h,Object.keys(w),s,I,u,y,m,f),function(){!function(e){be.setState((function(n){var t=C({},n.components);return delete t[e],{components:t}}))}(v)})}),[S]),t.useEffect((function(){S||function(e,n){be.setState((function(t){var o,r;return t.components[e]?{components:C({},t.components,(r={},r[e]=C({},null!=(o=t.components[e])?o:{},{children:n}),r))}:{}}))}(v,Object.keys(w))}),[w,S]);var k=t.useMemo((function(){return d.concat(i)}),[d]),T=t.useState({}),$=T[0],z=T[1],O=t.useCallback((function(e,n){z((function(t){var o;return C({},t,((o={})[e]=n,o))}))}),[z]);return S?null:o.createElement(Xe.Provider,{value:{id:v,componentTypeId:y,isRoot:!1,parentId:v,rootParentId:s?v:f,parentPath:k,registerWithParent:P,isSelected:g,sharedProps:$,setSharedProp:O}},o.createElement(Be,null,o.createElement(ze,null,r)))},We=function(e,n){void 0===n&&(n={});var o=Ze(),r=o.id,i=o.componentTypeId,a=o.setSharedProp,l=n.hidden,u=void 0!==l&&l,c=Ne(),s=t.useState((function(){return n.id?n.id:r}))[0],d=n.sync,p=void 0!==d&&d,m=Ve(e),f=function(e,n,o,r,i){var a,l,u=null!=(a=null==(l=we(n))?void 0:l.initialProps)?a:{},c=function(e){var n;return null!=(n=N((function(n){return n.components[e]})))?n:{}}(n),s=c.modifiedState,d=void 0===s?{}:s,p=c.overriddenState,m=void 0===p?{}:p,f=function(e){var n;return null!=(n=N((function(n){return n.sharedComponents[e]})))?n:{}}(o).appliedState,h=void 0===f?{}:f;return t.useMemo((function(){var n=h[e],t=null==n?void 0:n.value,o={hidden:i},a=C({},o,{value:t,type:oe.applied});if(d[e]&&!m[e]){var l=d[e].value;return l!==t?C({},o,{value:l,type:oe.modified}):a}return u[e]&&!m[e]?u[e]!==t?C({},o,{value:u[e],type:oe.initial}):a:n?a:C({},o,{value:r,type:oe.default})}),[u,d,m,h,r])}(e,s,i,n.defaultValue,u);t.useLayoutEffect((function(){if(e===Pt.children)return function(e){return be.setState((function(n){var t;return{componentsThatCanHaveChildren:C({},n.componentsThatCanHaveChildren,(t={},t[e]=!0,t))}})),function(){be.setState((function(n){var t=C({},n.componentsThatCanHaveChildren);return delete t[e],{componentsThatCanHaveChildren:t}}))}}(s)}),[]),t.useLayoutEffect((function(){c&&Pe(r,(function(n){var t;return C({},n,((t={})[e]=f,t))}))}),[c,f]);var h=f.value;return t.useLayoutEffect((function(){p&&a(e,h)}),[p]),!p&&m?m:f.value},Ue=function(e){var n,r,i=e.component,a=tn(null!=(n=i.componentId)?n:""),l=t.useMemo((function(){return null==a?void 0:a.component}),[a]);if(!a)return null;var u=null!=(r=i.initialProps)?r:{};return o.createElement(_e,Object.assign({id:i.uid,_config:{name:i.name,type:a.sharedType?i.componentId:"",_unsaved:!0}},u),l&&o.createElement(l,null))},He=function(e){var n,t=(n=e.id,N((function(e){return e.unsavedComponents[n]})));return t?o.createElement(Ue,{component:t}):null},Ke=function(e){return o.createElement(o.Fragment,null,e.ids.map((function(e){return o.createElement(He,{id:e,key:e})})))},Je=function(){var e,n=null!=(e=N((function(e){return e.unsavedComponents})))?e:{};return o.createElement(o.Fragment,null,Object.entries(n).map((function(e){var n=e[1];return n.isRoot?o.createElement(Ue,{key:e[0],component:n}):null})))},en=function(e){var n,t=e.children,r=null!=(n=We(Pt.children,{defaultValue:[],hidden:!0}))?n:[];return o.createElement(o.Fragment,null,t,r&&o.createElement(Ke,{ids:r}))},nn=u((function(){return{addables:{}}})),tn=function(e){return nn((function(n){return n.addables[e]}))},on=function(e,n,t){var o=t.name,r=t.sharedType,i=void 0===r||r,a=t.props,l=void 0===a?{}:a,u="_addable/"+e;nn.setState((function(e){var t;return{addables:C({},e.addables,(t={},t[u]={id:u,name:o,props:l,component:n,sharedType:i},t))}}))};on("_emptyObject",(function(){return o.createElement(en,null)}),{name:"Empty Object",sharedType:!1,props:{}});var rn,an,ln,un,cn,sn=s.proxy({displayAddingComponent:!1,displayAddingComponentParent:"",addingComponent:"",addingComponentParent:"",componentContextMenu:{visible:!1,components:[]},hoveredComponents:{}}),dn=function(e,n,t){var o,r;console.log("position",t);var i=function(e,n,t){var o=U();return q((function(r){var i,a;return{unsavedComponents:C({},r.unsavedComponents,(a={},a[o]={uid:o,name:e.name,componentId:e.id,children:[],isRoot:!n,initialProps:C({},null!=(i=e.props)?i:{},null!=t?t:{})},a))}})),n&&se(n,Pt.children,(function(e){return(e=e||[]).concat([o])})),H([n,o])}(function(e){return nn.getState().addables[e]}(e),n,((o={})[Pt.position]=t,o));de(((r={})[i]=!0,r))},pn=function(e){dn(sn.addingComponent,sn.addingComponentParent,e),sn.addingComponent="",sn.addingComponentParent=""},mn=function(e){var n;return sn.hoveredComponents=C({},sn.hoveredComponents,((n={})[e]=!0,n)),function(){var n=C({},sn.hoveredComponents);delete n[e],sn.hoveredComponents=n}},fn=function(e){sn.displayAddingComponentParent=e},hn=function(e,n){void 0===n&&(n=""),e&&fn(n),sn.displayAddingComponent=e,e||(vn=Date.now())},vn=0,yn=new g.Shortcuts,gn=function(e,n){t.useEffect((function(){return function(e,n){return n||(n=yn),n.add(e),function(){var t;null==(t=n)||t.remove(e)}}(e,n)}),[])},En=function(){return gn([{shortcut:"Backspace",handler:function(){fe()}},{shortcut:"Delete",handler:function(){fe()}},{shortcut:"CmdOrCtrl+C",handler:function(){var e;e={type:K.COMPONENTS,data:ie()},re.pendingPaste=s.ref(e)}}]),null};!function(e){e.group="group",e.component="component"}(un||(un={})),function(e){e.group="group",e.groupClosed="groupClosed",e.component="component"}(cn||(cn={}));var bn,wn=function(e,n,t,o){var r={},i=[],a={};Object.entries(n).forEach((function(e){var n=e[0];if(r[n]={id:n,children:[],data:{children:[],title:e[1].name,type:un.group}},t[n]){var o=t[n];a[o]?a[o].push(n):a[o]=[n]}else i.push(n)})),Object.entries(a).forEach((function(e){var n=e[0];r[n]&&(r[n].children=r[n].children.concat(e[1]),r[n].data.children=r[n].children)})),Object.entries(e).forEach((function(e){var n=e[0],o=e[1];if(r[n]={id:n,children:[],data:{children:o.children,title:o.name,type:un.component}},o.isRoot)if(t[n]){var a=t[n];r[a]&&(r[a].children.push(n),r[a].data.children=r[a].children)}else i.push(n)})),r.__root={id:"__root",children:i};var l=o?_().componentsTree:{};return Object.values(r).forEach((function(e){if(l[e.id]){var n=l[e.id],t=e.children.length,o=d.sortBy(e.children,(function(e){return-1!==n.children.indexOf(e)?n.children.indexOf(e):t}));e.children=o,e.isExpanded=n.isExpanded}})),{rootId:"__root",items:r}},Cn=function(e){var n=e.iconType;return o.createElement(n===cn.group?i.FaFolderOpen:n===cn.groupClosed?i.FaFolder:i.FaCube,{size:11})},xn=S("div",{paddingLeft:"12px"}),Mn=function(e){var n=e.id,t=function(e){return we(e)}(n);return t?o.createElement(An,{id:n,icon:o.createElement(Cn,{iconType:cn.component}),draggable:!1,name:t.name}):null},Pn=function(e){var n,t,r=null!=(n=null==(t=we(e.id))?void 0:t.children)?n:[];return o.createElement(xn,null,r.map((function(e){return o.createElement(Mn,{id:e,key:e})})))},Sn=S("div",{padding:"1px $1b"}),In=S("div",{position:"relative"}),kn=S("div",{position:"absolute",top:"0",left:"30px",right:"40px",bottom:"0",display:"flex",alignItems:"center"}),Tn=S("button",{padding:0,margin:0,border:0,font:"inherit",color:"inherit",backgroundColor:"transparent"}),$n=S(Tn,{display:"grid",alignItems:"center",width:"100%",gridTemplateColumns:"auto 1fr auto",columnGap:"$1b",padding:"$1b",borderRadius:"$2",cursor:"pointer",textAlign:"left",transition:"background 250ms ease, border 250ms ease, color 250ms ease","&:hover":{backgroundColor:"rgba(0,0,0,0.25)"},"&:focus":{outline:"none",boxShadow:"0 0 0 2px $pink"},variants:{appearance:{hovered:{backgroundColor:"rgba(0,0,0,0.25)"},selected:{color:"$white",backgroundColor:"$purple","&:hover":{backgroundColor:"$purple"}}}}}),zn=S(S("div",{width:"22px",height:"22px",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 250ms ease"}),{border:"2px solid transparent",variants:{appearance:{clickable:{"&:hover":{borderColor:"$purple",backgroundColor:"$purple",color:"$white"}}},style:{interactive:(rn={},rn[$n+":hover &"]={borderColor:"$darkPurple"},rn["&:hover"]={borderColor:"$purple",color:"$white"},rn)}}}),On=S(zn,((ln={opacity:0})[$n+":hover &"]={opacity:1},ln["&:hover"]={opacity:1},ln.variants={style:{interactive:(an={},an[$n+":hover &"]={borderColor:"$darkPurple"},an["&:hover"]={borderColor:"$purple",backgroundColor:"$purple",color:"$white"},an)}},ln)),Ln=S("span",{display:"inline-flex",justifyContent:"center",alignItems:"center",padding:"2px",marginLeft:"2px","&:hover":{color:"$white"}}),jn=S("div",{display:"flex",alignItems:"center"}),Rn="",Dn=function(e){Rn=e},Fn=function(e){var n=e.onChange,r=t.useState(e.name),i=r[0],a=r[1],l=t.useRef();return t.useEffect((function(){var e;null==(e=l.current)||e.focus()}),[]),o.createElement(kn,{as:"form",onSubmit:function(e){e.preventDefault(),n(i)}},o.createElement("input",{ref:l,type:"text",value:i,onChange:function(e){return a(e.target.value)},onClick:function(e){return e.stopPropagation()},onBlur:function(){return n("")}}))},An=function(e){var n=e.name,r=e.iconProps,a=void 0===r?{}:r,l=e.icon,u=e.id,c=e.isGroup,m=e.draggable,f=void 0===m||m,h=e.isExpanded,v=void 0!==h&&h,y=e.onClick,g=function(e){return Object.keys(ge()).includes(e)}(u),E=t.useState(!1),b=E[0],w=E[1],x=t.useRef(),M=function(e){var n;return null!=(n=be((function(n){return n.componentsThatCanHaveChildren[e]})))&&n}(u),P=Ee(u),S=t.useState(!1),I=S[0],k=S[1],T=function(e){var n;return null!=(n=s.useProxy(sn).hoveredComponents[e])&&n}(u),$=P||n;t.useEffect((function(){g&&x.current.focus()}),[g]),t.useEffect((function(){if(g&&b)return function(){var e;null==(e=x.current)||e.blur()}}),[g,b]),t.useEffect((function(){if(b&&g){var e=function(){p.isPressed(27)&&de({})};return p("*",e),function(){p.unbind("*",e)}}}),[b,g]);var z=t.useCallback((function(e){k(!1),e&&(c?function(e,n){q((function(t){var o,r;return{groups:C({},t.groups,(r={},r[e]=C({},null!=(o=t.groups[e])?o:{},{name:n}),r))}}))}(u,e):function(e,n){q((function(t){var o;return{componentNames:C({},t.componentNames,(o={},o[e]={name:n},o))}}))}(u,e))}),[c]),O=t.useMemo((function(){return{onNameClicked:function(){g&&k(!0)},onContextMenu:function(e){var n;e.preventDefault(),console.log("event",e),n=Object.keys(_().selectedComponents),sn.componentContextMenu={visible:!0,components:n,position:[e.clientX,e.clientY]}},onAddChild:function(e){e.stopPropagation(),hn(!0,u)},onDelete:function(e){e.stopPropagation(),me(u)},onFocus:function(){w(!0)},onBlur:function(){w(!1)},onClick:function(e){var n,t;e.stopPropagation(),null==(n=x.current)||n.focus(),Ce()?(t=g?function(e){var n=C({},e);return delete n[u],n}:function(e){var n;return C({},e,((n={})[u]=!0,n))},q((function(e){return{selectedComponents:t(e.selectedComponents)}})),Dn(u)):xe()?function(e){var n,t,o,r,i=(n=be.getState().components,t=_(),o=wn(n,t.groups,t.groupedComponents,!0),r=[],o.items[o.rootId].children.forEach((function(e){r.push(e);var n=o.items[e];n&&function e(n,t,o){n.children.forEach((function(n){t.push(n);var r=o.items[n];r&&e(r,t,o)})),n.data.children&&n.data.children.forEach((function(n){t.push(n);var r=o.items[n];r&&e(r,t,o)}))}(n,r,o)})),r);if(!Rn){var a=Object.keys(ie()),l=a.length,u=d.sortBy(a,(function(e){return-1!==i.indexOf(e)?i.indexOf(e):l}));Rn=u[0]}var c=i.indexOf(Rn),s=i.indexOf(e),p=s<c,m=i.slice(p?s:c,(p?c:s)+1),f={};m.forEach((function(e){f[e]=!0})),de(f)}(u):(function(e){var n;de(((n={})[e]=!0,n))}(u),Dn(u))}}}),[g]),L=O.onClick,j=O.onFocus,R=O.onBlur,D=O.onAddChild,F=O.onContextMenu,A=O.onNameClicked;return o.createElement(o.Fragment,null,b&&o.createElement(En,null),o.createElement(Sn,null,o.createElement(In,null,o.createElement($n,{ref:x,onClick:L,onFocus:j,onBlur:R,onContextMenu:F,appearance:g?"selected":T?"hovered":""},o.createElement(zn,Object.assign({},a,{style:f?"interactive":""}),l),o.createElement("div",null,o.createElement("span",{onClick:A},$),c&&o.createElement(Ln,{onClick:function(e){e.preventDefault(),e.stopPropagation(),y()}},o.createElement(v?i.FaCaretUp:i.FaCaretDown,{size:11}))),o.createElement(jn,null,M&&o.createElement(On,{style:"interactive",onClick:D},o.createElement(i.FaPlus,{size:10})))),I&&o.createElement(Fn,{name:$,onChange:z}))),!c&&o.createElement(Pn,{id:u}))},Yn=function(e){var n,t,r=e.item,i=e.onExpand,a=e.onCollapse,l=e.provided,u=r.data.type===un.group,c=r.children.length>0&&r.isExpanded,s=r.isExpanded,d=void 0!==s&&s,p=null!=(n=null==l?void 0:l.dragHandleProps)?n:{},m=C(c?{}:{onBlur:p.onBlur,onDragStart:p.onDragStart,onFocus:p.onFocus,onKeyDown:p.onKeyDown,onMouseDown:p.onMouseDown,onTouchStart:p.onTouchStart},x(p,["onBlur","onDragStart","onFocus","onKeyDown","onMouseDown","onTouchStart"])),f=u?d?cn.group:cn.groupClosed:cn.component;return o.createElement("div",Object.assign({ref:l.innerRef},l.draggableProps),o.createElement(An,{id:r.id,itemChildren:null!=(t=r.data.children)?t:[],iconProps:m,onClick:u?function(){d?a(r.id):i(r.id)}:void 0,icon:o.createElement(Cn,{iconType:f}),isGroup:u,draggable:!c,isExpanded:d,name:r.data?r.data.title:""}))},Gn=S("div",{overflowY:"auto",padding:"6px 0"}),Bn=function(e){var n=e.view===bn.active,r=function(e){var n=be((function(e){return e.components})),o=be((function(e){return e.deactivatedComponents})),r=N((function(e){return e.groups})),i=N((function(e){return e.groupedComponents})),a=e?n:o,l=t.useState((function(){return wn(a,r,i,e)})),u=l[0],c=l[1];return t.useEffect((function(){c(wn(a,r,i,e))}),[a,r,i]),[u,c]}(n),i=r[0],u=r[1],c=t.useMemo((function(){return{onExpand:function(e){u(a.mutateTree(i,e,{isExpanded:!0})),pe(e,!0)},onCollapse:function(e){u(a.mutateTree(i,e,{isExpanded:!1})),pe(e,!1)},onDragEnd:function(e,n){if(n){var t=i.items[n.parentId];if("__root"===n.parentId||t&&t.data.type===un.group){var o=a.moveItemOnTree(i,e,n);if(e.parentId!==n.parentId){var r=i.items[e.parentId].children[e.index];if(!r)throw new Error("Id not found "+r);!function(e,n){"__root"===n?q((function(n){var t=C({},n.groupedComponents);return delete t[e],{groupedComponents:t}})):_().groups[n]&&ye([e],n)}(r,n.parentId)}!function(e){var n={};Object.values(e.items).forEach((function(e){n[e.id]={children:e.children,isExpanded:e.isExpanded}})),q({componentsTree:n})}(o),u(o)}}}}}),[i]);return o.createElement(Gn,null,o.createElement(l,{tree:i,renderItem:Yn,onExpand:c.onExpand,onCollapse:c.onCollapse,onDragEnd:c.onDragEnd,isDragEnabled:n,isNestingEnabled:n,offsetPerLevel:12,key:n?"active":"deactivated"}))},Xn=S("div",{display:"grid",height:"100%",gridTemplateRows:"auto minmax(0, 1fr) auto"}),Zn=S(Tn,{cursor:"pointer",color:"$midPurple","&:hover":{color:"$lightPurple",textDecoration:"underline"}}),Vn=S(Tn,{fontSize:"$1b",fontWeight:"$medium",border:"2px solid $purple",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"9999999px",padding:"$2",transition:"200ms ease all","&:not(:disabled)":{cursor:"pointer"},"&:hover:not(:disabled)":{borderColor:"$purple",backgroundColor:"$purple",color:"$white"},"&:disabled":{borderColor:"transparent",opacity:.6},variants:{appearance:{faint:{borderColor:"$darkPurple"}},shape:{tiny:{padding:"0 $1b",fontSize:"$1"},full:{width:"100%"},thinner:{padding:"0 $2b",height:"25px"},thinnerWide:{padding:"0 $2b",height:"25px",width:"100%"},round:{padding:"0",width:"25px",height:"25px"}}}}),Qn=S("h3",{fontSize:"$1b"}),Nn=S("div",{maxHeight:"100%"}),qn=S("div",{padding:"$2b $3",variants:{visual:{top:{borderBottom:"1px solid $faint"},bottom:{borderTop:"1px solid $faint"}}}}),_n=S(qn,{display:"grid",alignItems:"center",gridTemplateColumns:"1fr auto",columnGap:"$2"});!function(e){e.active="active",e.deactivated="deactivated"}(bn||(bn={}));var Wn,Un,Hn=function(){var e=t.useState(bn.active),n=e[0],r=e[1];return o.createElement(Xn,null,o.createElement(_n,{visual:"top"},o.createElement(Qn,null,"Scene"),o.createElement("div",null,o.createElement("select",{value:n,onChange:function(e){return r(e.target.value)}},o.createElement("option",{value:bn.active},"Active"),o.createElement("option",{value:bn.deactivated},"Deactivated")))),o.createElement(Nn,{onClick:function(){!sn.displayAddingComponent&&vn<Date.now()-50&&de({})}},o.createElement(Bn,{view:n})),o.createElement(qn,{visual:"bottom"},o.createElement(Vn,{shape:"full",onClick:function(){hn(!0)}},"Add Component")))},Kn=function(e){var n=e.inputId,r=e.value,i=e.onChange,a=e.options,l=t.useState(null!=r?r:""),u=l[0],c=l[1];t.useEffect((function(){c(null!=r?r:"")}),[r]);var s=t.useMemo((function(){return{onChange:function(e){var n=e.target.value;c(n),i(n)}}}),[i]);return o.createElement("select",{id:n,value:u,onChange:s.onChange},a.map((function(e){var n;return o.createElement("option",{key:e.value,value:e.value},null!=(n=e.label)?n:e.value)})))},Jn=S("div",{display:"flex",alignItems:"center","> button":{marginLeft:"$1"}}),et=function(e){var n=e.inputValue,r=e.propType,i=e.componentId,a=e.propKey,l=e.componentTypeId,u=t.useCallback((function(){!function(e,n,t){q((function(o){var r,i,a,l,u=null!=(r=o.sharedComponents[e])?r:{};return u=C({},u,{appliedState:C({},null!=(i=u.appliedState)?i:{},(a={},a[n]={value:t},a))}),{sharedComponents:C({},o.sharedComponents,(l={},l[e]=u,l))}}))}(l,a,n)}),[n]),c=t.useMemo((function(){return{onReset:function(){!function(e,n){q((function(t){var o,r,i,a,l=null!=(o=t.components[e])?o:{};return l=C({},l,{overriddenState:C({},null!=(r=l.overriddenState)?r:{},(i={},i[n]=!0,i))}),{components:C({},t.components,(a={},a[e]=l,a))}}))}(i,a)}}}),[]);return o.createElement(Jn,null,(r===oe.modified||r===oe.initial)&&o.createElement(o.Fragment,null,o.createElement(Zn,{onClick:c.onReset},"reset"),!!l&&o.createElement(Zn,{onClick:u},"apply")))},nt=t.createContext({propType:"",propKey:"",componentId:"",componentTypeId:""}),tt=function(e){var n,r=e.componentId,i=e.componentTypeId,a=e.value,l=e.propKey,u=e.propType,c=e.onChange,s=t.useState(a),d=s[0],p=s[1],m=t.useCallback((function(e){le(),se(r,l,e),c&&c(e)}),[r]),f=t.useMemo((function(){return{onChange:function(e){p(e),m(e)}}}),[m]).onChange;t.useEffect((function(){p(a)}),[a]);var h=t.useMemo((function(){return xt[l]}),[l]),v=t.useMemo((function(){var e;return null!=(e=null==h?void 0:h.input)?e:G}),[h]),y=null!=(n=null==h?void 0:h.defaultValue)?n:"";return o.createElement(nt.Provider,{value:{propType:u,propKey:l,componentId:r,componentTypeId:i}},o.createElement("div",null,v&&o.createElement(v,{inputId:"input-"+l,value:null!=d?d:y,onChange:f})))},ot=function(e){var n=e.componentId,t=e.componentTypeId;return o.createElement("div",null,Object.entries(e.props).map((function(e){var r=e[0],i=e[1];return void 0===i.value?null:o.createElement(tt,{key:r,propKey:r,propType:i.type,value:i.value,componentId:n,componentTypeId:t})})))},rt=S("div",{}),it=S("div",{padding:"$3",borderTop:"1px solid $faint"}),at=S("div",{display:"grid",alignItems:"center",gridTemplateColumns:"auto 1fr auto",columnGap:"$2"}),lt=S("label",{fontSize:"$1b",fontWeight:"$semi"}),ut=S("div",{display:"grid",alignItems:"center",gridTemplateColumns:"auto 1fr",columnGap:"$2",marginTop:"$2"}),ct=S("label",{minWidth:"60px",display:"inline-grid",fontSize:"$1b"}),st=S("div",{marginTop:"$3"}),dt=S("div",{border:"1px solid $faint",marginLeft:"-$2",marginRight:"-$2",maxWidth:"none",marginTop:"$2"}),pt=S("header",{padding:"$2",display:"grid",gridTemplateColumns:"auto 1fr",columnGap:"$2",alignItems:"center"});!function(e){e.BALL="BALL",e.CUBIOD="CUBIOD"}(Wn||(Wn={})),function(e){e.DYNAMIC="DYNAMIC",e.STATIC="STATIC",e.KINEMATIC="KINEMATIC"}(Un||(Un={}));var mt,ft,ht=[{value:Un.DYNAMIC,label:"Dynamic"},{value:Un.STATIC,label:"Static"},{value:Un.KINEMATIC,label:"Kinematic"}],vt=S("div",{padding:"$2",borderTop:"1px solid $faint"}),yt=function(e){var n=e.collider,r=e.onChange,a=e.onDelete,l=n.colliderType,u=n.key,c=n.radius,s=void 0===c?1:c,d=n.hx,p=void 0===d?.5:d,m=n.hy,f=void 0===m?.5:m,h=n.hz,v=void 0===h?.5:h,y=t.useMemo((function(){return{updateValue:function(e){var t=C({},n,e);r(t)}}}),[r]).updateValue;return o.createElement(vt,null,o.createElement(ut,{css:{gridTemplateColumns:"auto 1fr auto",marginTop:"0"}},o.createElement(ct,{htmlFor:u+"-shape"},"Shape"),o.createElement("div",null,o.createElement(Kn,{inputId:u+"-shape",value:l,onChange:function(e){y({colliderType:e})},options:[{value:Wn.BALL,label:"Ball"},{value:Wn.CUBIOD,label:"Cubiod"}]})),o.createElement("div",null,o.createElement("button",{onClick:a},o.createElement(i.FaTimes,{size:11})))),l===Wn.BALL&&o.createElement(o.Fragment,null,o.createElement(ut,null,o.createElement(ct,{htmlFor:u+"-radius"},"Radius"),o.createElement(F,{inputId:u+"-radius",value:s,onChange:function(e){y({radius:e})}}))),l===Wn.CUBIOD&&o.createElement(o.Fragment,null,o.createElement(ut,null,o.createElement(ct,{htmlFor:u+"-hx"},"hx"),o.createElement(F,{inputId:u+"-hx",value:p,onChange:function(e){y({hx:e})}})),o.createElement(ut,null,o.createElement(ct,{htmlFor:u+"-hy"},"hy"),o.createElement(F,{inputId:u+"-hy",value:f,onChange:function(e){y({hy:e})}})),o.createElement(ut,null,o.createElement(ct,{htmlFor:u+"-hz"},"hz"),o.createElement(F,{inputId:u+"-hz",value:v,onChange:function(e){y({hz:e})}}))))},gt={key:"__modules",label:"Modules"},Et={key:"__rigidBody3dModule",label:"RigidBody 3D",input:function(e){var n=e.value,r=e.inputId,a=e.onChange,l=t.useState(!0),u=l[0],c=l[1],s=n.enabled,d=void 0===s||s,p=n.bodyType,m=void 0===p?Un.DYNAMIC:p,f=n.mass,h=void 0===f?1:f,v=n.colliders,y=void 0===v?[]:v,g=t.useMemo((function(){return{addCollider:function(){var e={key:Date.now().toString(),colliderType:Wn.BALL},t=C({},n,{colliders:y.concat([e])});a(t)},updateCollider:function(e,t){var o=y.slice();o[e]=t;var r=C({},n,{colliders:o});a(r)},deleteCollider:function(e){var t=y.slice();t.splice(e,1);var o=C({},n,{colliders:t});a(o)}}}),[n,y]),E=g.addCollider,b=g.updateCollider,w=g.deleteCollider,x=t.useContext(nt),M=x.propKey,P=x.propType,S=x.componentTypeId,I=x.componentId;return o.createElement(it,null,o.createElement(at,null,o.createElement("div",null,o.createElement("input",{id:r,type:"checkbox",checked:d,onChange:function(e){var t=C({},n,{enabled:e.target.checked});a(t)}})),o.createElement(rt,{css:{display:"grid",alignItems:"center",gridTemplateColumns:"auto 1fr",columnGap:"$0b"}},o.createElement(lt,{htmlFor:r},"RigidBody 3D"),o.createElement(et,{propKey:M,propType:P,componentId:I,componentTypeId:S,inputValue:n})),o.createElement("div",null,o.createElement("button",{onClick:function(){c((function(e){return!e}))}},o.createElement(u?i.FaCaretUp:i.FaCaretDown,null)))),u&&o.createElement(st,null,o.createElement(ut,null,o.createElement(ct,{htmlFor:"rigidBody3d-type"},"Type"),o.createElement("div",null,o.createElement(Kn,{inputId:"rigidBody3d-type",value:m,onChange:function(e){var t=C({},n,{bodyType:e});a(t)},options:ht}))),m===Un.DYNAMIC&&o.createElement(ut,null,o.createElement(ct,{htmlFor:"rigidBody3d-mass"},"Mass"),o.createElement("div",null,o.createElement(F,{inputId:"rigidBody3d-mass",value:h,onChange:function(e){var t=C({},n,{mass:e});a(t)}}))),o.createElement(dt,null,o.createElement(pt,null,o.createElement("div",null,o.createElement(ct,null,"Colliders")),o.createElement(Vn,{shape:"thinnerWide",onClick:E},"Add Collider")),y.length>0&&o.createElement("div",null,y.map((function(e,n){return o.createElement("div",{key:e.key},o.createElement(yt,{collider:e,onChange:function(e){b(n,e)},onDelete:function(){w(n)}}))}))))))},defaultValue:void 0},bt={key:"__position",label:"Position",input:V,defaultValue:{x:0,y:0,z:0}},wt={key:"__rotation",label:"Rotation",input:V,defaultValue:{x:0,y:0,z:0}},Ct={key:"__scale",label:"Scale",input:V,defaultValue:{x:1,y:1,z:1}},xt=((mt={})[bt.key]=bt,mt[wt.key]=wt,mt[Ct.key]=Ct,mt[Et.key]=Et,mt),Mt=((ft={})[Et.key]=Et,ft),Pt={position:bt.key,rotation:wt.key,scale:Ct.key,rigidBody3d:Et.key,modules:gt.key,children:"__children"},St=S("div",{height:"100%",display:"grid",gridTemplateRows:"1fr auto"}),It=S("div",{marginTop:"$2"}),kt=S("header",{display:"flex",alignItems:"center",padding:"0 $3",marginBottom:"$1",minHeight:"18px"}),Tt=S("label",{fontSize:"$1b"}),$t=S("div",{padding:"0 $3"}),zt=function(e){var n,r=e.componentId,i=e.componentTypeId,a=e.propKey,l=e.value,u=e.propType,c=t.useState(l),s=c[0],d=c[1];t.useEffect((function(){d(l)}),[l]);var p="input-"+a,m=t.useMemo((function(){return xt[a]}),[a]),f=null!=(n=null==m?void 0:m.label)?n:a;return o.createElement(It,null,o.createElement(kt,null,o.createElement(Tt,{htmlFor:p},f||a),o.createElement(et,{propKey:a,propType:u,componentId:r,componentTypeId:i,inputValue:s})),o.createElement($t,null,o.createElement(tt,{propType:u,componentId:r,componentTypeId:i,value:l,propKey:a,onChange:d})))},Ot=[bt.key,wt.key,Ct.key],Lt=function(e,n){var t=n[0],o=Ot.indexOf(e[0]);o=-1===o?9999:o;var r=Ot.indexOf(t);return o-(-1===r?9999:r)},jt=function(e){var n=e.componentId,t=e.componentTypeId;return o.createElement("div",null,Object.entries(e.props).sort(Lt).map((function(e){var r=e[0],i=e[1];return o.createElement(zt,{componentId:n,componentTypeId:t,key:r,propKey:r,value:i.value,propType:i.type})})))},Rt=function(e){var n,r=e.id,i=function(e){var n;return null!=(n=Me((function(n){return n.components[e]})))?n:{}}(r),a=we(r),l=null!=(n=null==a?void 0:a.componentId)?n:"",u=gt.key,c=i[u],s=x(i,[u].map(M)),d=t.useMemo((function(){var e={},n={};return Object.entries(s).forEach((function(t){var o=t[0],r=t[1];r.hidden||(Mt[o]?n[o]=r:e[o]=r)})),{customProps:e,bottomProps:n}}),[s]),p=d.customProps,m=d.bottomProps,f=t.useMemo((function(){return{addModule:function(){i[Et.key]&&void 0!==i[Et.key].value||se(r,Et.key,{enabled:!0})}}}),[i]).addModule;return o.createElement(o.Fragment,null,o.createElement(St,null,o.createElement(jt,{componentId:r,componentTypeId:l,props:p}),c&&o.createElement(ot,{componentId:r,componentTypeId:l,props:m})),c&&o.createElement(qn,{visual:"bottom"},o.createElement(Vn,{shape:"full",onClick:f},"Add Module")))},Dt=S("div",{height:"100%",display:"grid",gridTemplateRows:"auto 1fr auto"}),Ft=t.createContext(null),At=function(e){var n,t=e.id,r=we(t),i=Ee(t)||(null!=(n=null==r?void 0:r.name)?n:"");return o.createElement(qn,{visual:"top"},o.createElement(Qn,null,i))},Yt=function(){var e,n=1===(e=Object.keys(ge())).length?e[0]:"";return n?o.createElement(Ft.Provider,{value:{selectedComponent:n}},o.createElement(Dt,null,o.createElement(At,{id:n}),o.createElement(Rt,{id:n,key:n}))):null},Gt=S("div",{position:"absolute",left:"100%",top:0,bottom:0,zIndex:"$high",width:"260px",backgroundColor:"$darkGreyLighter",borderLeft:"1px solid $darkGrey",padding:"$2",overflowY:"auto"}),Bt=S($n,{"&:not(:first-child)":{marginTop:"$0b"}}),Xt=S("span",{position:"relative",left:"1px"}),Zt=function(){hn(!1),fn("")},Vt=function(e){var n=e.label,t=e.addableId;return o.createElement(Bt,{onClick:function(){dn(t,sn.displayAddingComponentParent),Zt()}},o.createElement(zn,null,o.createElement(Cn,{iconType:cn.component})),o.createElement("div",null,n),o.createElement(zn,{appearance:"clickable",onClick:function(e){e.stopPropagation(),sn.addingComponent=t,sn.addingComponentParent=sn.displayAddingComponentParent,Zt()}},o.createElement(Xt,null,o.createElement(i.FaMousePointer,{size:10}))))},Qt=function(){var e=s.useProxy(sn).displayAddingComponent,n=nn((function(e){return e.addables}));return e?o.createElement(b,{onOutsideClick:Zt},o.createElement(Gt,null,Object.entries(n).map((function(e){var n=e[1];return o.createElement(Vt,{addableId:n.id,label:n.name,key:e[0]})})))):null},Nt=S("div",{zIndex:"$max",backgroundColor:"$darkGrey",padding:"$1 0",width:"180px",border:"1px solid $lightPurple",borderRadius:"$1"}),qt=S(Tn,{width:"100%",padding:"$1 $2",textAlign:"left",cursor:"pointer",fontSize:"$1b",fontWeight:"$semi","&:hover":{backgroundColor:"$purple",color:"$white"}}),_t=function(){sn.componentContextMenu={visible:!1}},Wt=function(e){var n,r=e.components,i=t.useMemo((function(){var e=!0,t=!1,o=!1,r=!1,i=be.getState(),a=i.components,l=i.deactivatedComponents;return n.forEach((function(n){a[n]?(t=!0,a[n].isRoot||(e=!1)):l[n]?o=!0:r=!0})),{allRoot:e,hasComponents:t,hasInactiveComponents:o,hasGroups:r}}),[n=r]),a=i.allRoot,l=i.hasComponents,u=i.hasInactiveComponents,c=i.hasGroups,s=t.useMemo((function(){return{onGroup:function(){ye(r),_t()},onDelete:function(){fe(),_t()},onReactivate:function(){var e;e=r,q((function(n){var t=C({},n.deactivatedComponents);return e.forEach((function(e){delete t[e]})),{deactivatedComponents:t}})),_t()}}}),[r]),d=s.onDelete,p=s.onReactivate,m=s.onGroup,f=t.useMemo((function(){var e=r.length>1,n=[],t=a;return!u&&(c?(l||c)&&t&&n.push(o.createElement(qt,{onClick:m,key:"group"},"Group")):(t&&n.push(o.createElement(qt,{onClick:m,key:"groupComponents"},"Group component",e?"s":"")),n.push(o.createElement(qt,{onClick:d,key:"delete"},"Delete component",e?"s":"")))),u&&n.push(o.createElement(qt,{onClick:p,key:"restore"},"Restore")),n}),[r,d,p,m,l,u,c,a]);return o.createElement(Nt,null,f)},Ut=function(){var e=s.useProxy(sn).componentContextMenu;if(!e.visible)return null;var n=e.position,t=void 0===n?[0,0]:n,r=e.components;return o.createElement(b,{onOutsideClick:_t},o.createElement("div",{style:{position:"fixed",left:t[0]+"px",top:t[1]+"px"}},o.createElement(Wt,{components:void 0===r?[]:r})))},Ht=function(){var e=t.useRef({lastUndo:0,lastRedo:0,lastPaste:0,lastSave:0});return gn([{shortcut:"CmdOrCtrl+Z",handler:function(){var n=Date.now();n>e.current.lastUndo+100&&(e.current.lastUndo=n,ue())}},{shortcut:"CmdOrCtrl+Shift+Z",handler:function(){var n=Date.now();n>e.current.lastRedo+100&&(e.current.lastRedo=n,ce())}},{shortcut:"CmdOrCtrl+S",handler:function(e){e.preventDefault()}},{shortcut:"CmdOrCtrl+V",handler:function(){var n=Date.now();n>e.current.lastPaste+100&&(e.current.lastPaste=n,function(){if(re.pendingPaste)switch(re.pendingPaste.type){case K.COMPONENTS:!function(e){le();var n={};(function(e){var n=[];return q((function(t){var o=C({},t);return e.forEach((function(e){var t=function e(n,t,o,r){console.log("looking for",t);var i,a=U(),l=r?H([r,a]):a,u=n.unsavedComponents[t];u&&(n.unsavedComponents=C({},n.unsavedComponents,((i={})[a]=C({},u,{uid:a,children:[]}),i)));var c,s=n.components[o];if(s){var d;n.components=C({},n.components,((d={})[l]=s,d));var p=function(e,n){var t=e.modifiedState;return(void 0===t?{}:t)[Pt.children]}(s);if(p){var m,f,h=p.value,v=[];(void 0===h?[]:h).forEach((function(o){v.push(e(n,o,H([t,o]),l))})),n.components[l]=C({},s,{modifiedState:C({},null!=(m=s.modifiedState)?m:{},(f={},f[Pt.children]={value:v},f))})}}return n.groupedComponents[t]&&(n.groupedComponents=C({},n.groupedComponents,((c={})[l]=n.groupedComponents[t],c))),console.log("newId",l,a),a}(o,e,e);n.push(t)})),o})),n})(e).forEach((function(e){n[e]=!0})),de(n)}(Object.keys(re.pendingPaste.data))}re.pendingPaste=null}())}}]),null},Kt=S("header",{backgroundColor:"$darkGrey",display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center",height:"$headerHeight",padding:"0 $2"}),Jt=S("div",{width:"300px",h3:{fontSize:"$2",letterSpacing:"1px"}}),eo=S("div",{display:"flex",justifyContent:"center"}),no=S(Jt,{display:"flex",alignItems:"center",justifyContent:"flex-end","> *:not(:last-child)":{marginRight:"$1"}}),to=function(){var e=ee();return o.createElement(Kt,null,o.createElement(Jt,null,o.createElement("h3",null,"RGG")),o.createElement(eo,null,o.createElement(Vn,{shape:"thinner",onClick:function(){J.editMode=!e}},e?"Play":"Edit")),o.createElement(no,null,o.createElement(Vn,{shape:"thinner",appearance:"faint",onClick:function(){console.log(_()),console.log(be.getState())}},"Debug"),o.createElement(Vn,{shape:"thinner",appearance:"faint"},"Discard"),o.createElement(Vn,{shape:"round",appearance:"faint",onClick:ue},o.createElement(i.FaUndo,{size:9})),o.createElement(Vn,{shape:"round",appearance:"faint",disabled:!0,onClick:ce},o.createElement(i.FaRedo,{size:9})),o.createElement(Vn,{shape:"thinner"},"Save")))},oo=S(S("div",{color:"$lightPurple",fontFamily:"$main",fontSize:"$2"}),{backgroundColor:"$darkGrey",position:"fixed",top:0,left:0,right:0,bottom:0,display:"grid",gridTemplateRows:"auto minmax(0, 1fr)"}),ro=S("div",{display:"grid",gridTemplateColumns:"auto minmax(0, 1fr) auto"}),io=S("div",{width:"$sidebar",backgroundColor:"$darkGreyLighter",position:"relative",maxHeight:"100%"}),ao=S("div",{position:"relative"}),lo=S(Tn,{display:"flex",justifyContent:"center",alignItems:"center",width:"26px",height:"26px",cursor:"pointer",variants:{appearance:{active:{backgroundColor:"$purple",color:"$white"}}}}),uo=function(){var e=ne();return o.createElement(rt,{css:{position:"absolute",top:"$1",right:"$1",zIndex:"$high",display:"grid",gridTemplateColumns:"auto auto auto",backgroundColor:"$darkGrey"}},o.createElement(lo,{appearance:e===I.translate?"active":"",onClick:function(){te(I.translate)}},o.createElement(w.BiMove,{size:16})),o.createElement(lo,{appearance:e===I.rotate?"active":"",onClick:function(){te(I.rotate)}},o.createElement(w.BiRotateLeft,{size:16})),o.createElement(lo,{appearance:e===I.scale?"active":"",onClick:function(){te(I.scale)}},o.createElement(w.BiExpand,{size:15})))},co=function(){var e=ee();return o.createElement(o.Fragment,null,o.createElement("gridHelper",{visible:e,position:[0,0,-.01],args:[1e3,1e3,"#888","#111"],rotation:[0,0,0],layers:[31]}))},so=function(){var e=t.useRef(null),n=t.useRef(null),r=ee(),i=y.useThree().setDefaultCamera;t.useLayoutEffect((function(){r&&i(e.current)}),[r]),t.useEffect((function(){J.orbitRef=s.ref(n)}),[]),t.useEffect((function(){n.current&&(n.current.enabled=r)}),[r]),t.useLayoutEffect((function(){e.current.layers.enable(31),e.current.lookAt(0,5,0)}),[]);var a=s.useProxy(J).selectedRef,l=De((function(){a&&a&&(e.current.position.set(a.current.position.x+0,a.current.position.y+25,a.current.position.z+20),n.current.target=(new f.Vector3).copy(a.current.position))}),[a]);return Re("*",(function(){p.isPressed(32)&&l.current()})),t.useEffect((function(){e.current.position.set(0,25,20)}),[]),o.createElement(o.Fragment,null,o.createElement(v.PerspectiveCamera,{ref:e}),o.createElement(v.OrbitControls,{ref:n}))},po=function(){var e=t.useRef(null),n=t.useRef(null),r=y.useThree().camera,i=t.useState(!0),a=i[0],l=i[1],u=t.useRef({x:0,z:0,y:0,disabled:!1,pointerDown:!1}).current;t.useEffect((function(){var e=function(){u.pointerDown=!0},n=function(){u.pointerDown=!1,u.disabled=!1},t=function(){u.pointerDown&&(u.disabled=!0)},o=function(){e()},r=function(){n()};return window.addEventListener("pointermove",t),window.addEventListener("mousemove",t),window.addEventListener("mousedown",e),window.addEventListener("mouseup",n),window.addEventListener("pointerdown",o),window.addEventListener("pointerup",r),function(){window.removeEventListener("pointermove",t),window.removeEventListener("mousemove",t),window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",n),window.removeEventListener("pointerdown",o),window.removeEventListener("pointerup",r)}}),[]);var c=t.useMemo((function(){return{onVerticalPointerUp:function(e){a||u.disabled||(e.stopPropagation(),pn({x:u.x,y:e.point.y,z:u.z}))},onFloorPointerUp:function(e){if(a&&!u.disabled){e.stopPropagation();var n=e.point;pn({x:n.x,y:u.y,z:n.z})}},onFloorPointerMove:function(e){if(a&&!u.disabled){e.stopPropagation();var n=e.point,t=n.z;u.x=n.x,u.z=t}},onVerticalMove:function(e){a||u.disabled||(e.stopPropagation(),u.y=e.point.y)}}}),[a]),s=c.onFloorPointerMove,d=c.onVerticalPointerUp,p=c.onVerticalMove,m=c.onFloorPointerUp;t.useEffect((function(){e.current.position.x=u.x,e.current.position.z=u.z,e.current.position.y=u.y,n.current.position.x=Math.round(u.x),n.current.position.y=u.y,n.current.position.z=Math.round(u.z)}),[a]);var h=t.useRef(null);return y.useFrame((function(){e.current.rotation.y=Math.atan2(r.position.x-e.current.position.x,r.position.z-e.current.position.z),h.current.position.y=u.y,h.current.position.x=u.x,h.current.position.z=u.z})),t.useEffect((function(){var e=function(){l(!xe())};return document.addEventListener("keydown",e),document.addEventListener("keyup",e),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",e)}}),[]),o.createElement(o.Fragment,null,o.createElement(v.Plane,{args:[256,256],onPointerMove:s,onPointerUp:m,rotation:[-Math.PI/2,0,0],ref:n},o.createElement("meshBasicMaterial",{transparent:!0,opacity:0,side:f.DoubleSide}),o.createElement("gridHelper",{rotation:[-Math.PI/2,0,0],visible:a,position:[0,0,0],args:[1e3,1e3,"rgb(28,113,255, 0.05)","rgb(28,113,255, 0.05)"],layers:[31]})),o.createElement(v.Plane,{args:[256,256],onPointerMove:p,onPointerUp:d,ref:e},o.createElement("meshBasicMaterial",{transparent:!0,opacity:0,side:f.DoubleSide}),o.createElement("gridHelper",{rotation:[-Math.PI/2,0,0],visible:!a,args:[1e3,1e3,"rgb(28,113,255, 0.05)","rgb(28,113,255, 0.05)"],layers:[31]})),o.createElement("group",{ref:h},o.createElement(v.Sphere,null,o.createElement("meshBasicMaterial",{color:"green"}))))},mo=new f.Vector3,fo=function(){var e=t.useRef(null),n=ge(),r=Object.keys(n).length>1;t.useEffect((function(){return J.groupPortalRef=s.ref(e),function(){J.groupPortalRef=null}}),[]),Ge(e,r);var i=t.useRef(new f.Object3D),a=t.useRef(new f.Vector3),l=t.useCallback((function(){var n,t,o=(n=e.current,t=(new f.Box3).setFromObject(n),console.log("boundingBox",t),t.getCenter(mo),console.log("center",mo),mo);a.current=o,i.current.position.set(o.x,o.y,o.z)}),[]);t.useEffect((function(){r&&(e.current.position.set(0,0,0),setTimeout(l))}),[r,n]);var u=t.useRef(!1),c=t.useRef(new f.Vector3),d=De((function(){var t=e.current.position.x-c.current.x,o=e.current.position.y-c.current.y,r=e.current.position.z-c.current.z;Object.keys(n).forEach((function(e){se(e,Pt.position,(function(e){return e||(e={x:0,y:0,z:0}),{x:e.x+t,y:e.y+o,z:e.z+r}}))})),e.current.position.set(0,0,0),l()}),[n]);return Ae("",r,{updateValue:function(e){e===Pt.position&&d.current()},onChange:function(){u.current&&(e.current.position.x=-1*(a.current.x-i.current.position.x),e.current.position.y=-1*(a.current.y-i.current.position.y),e.current.position.z=-1*(a.current.z-i.current.position.z))},onDraggingChanged:function(n){console.log("onDraggingChanged",n),c.current.copy(e.current.position),u.current=n.value},passedRef:i}),o.createElement(o.Fragment,null,o.createElement("group",{ref:e}),o.createElement("group",{ref:i}))},ho=function(){var e=s.useProxy(sn).addingComponent;return o.createElement(o.Fragment,null,o.createElement(co,null),o.createElement(so,null),o.createElement(fo,null),e&&o.createElement(po,null))};console.warn("TODO!!! - 'apply' function is stale, when updating component prop value"),exports.EditCanvas=function(e){var n=e.children,t=ee();return o.createElement(o.Fragment,null,n,t&&o.createElement(ho,null),o.createElement(Je,null))},exports.Editable=_e,exports.Editor=function(e){var n=e.children;return t.useEffect((function(){p("*",(function(){}))}),[]),o.createElement(o.Fragment,null,o.createElement(E,{fonts:[{font:"Roboto",weights:[400,500,600,700]}]}),o.createElement(Ht,null),o.createElement(oo,null,o.createElement(to,null),o.createElement(ro,null,o.createElement(io,null,o.createElement(Hn,null),o.createElement(Qt,null)),o.createElement(ao,null,n,o.createElement(uo,null)),o.createElement(io,{css:{width:"$sidebarPlus"}},o.createElement(Yt,null))),o.createElement(Ut,null)))},exports.InteractiveMesh=Be,exports.predefinedPropKeys=Pt,exports.registerAddable=on,exports.useEditCanvasProps=function(){var e,n=(e=ge(),Object.keys(e).length>0),o=ee();return t.useMemo((function(){return{onPointerMissed:function(){o&&n&&de({})}}}),[n])},exports.useEditableProp=We,exports.useEditableSharedProp=Ve,exports.useIsEditMode=ee;
//# sourceMappingURL=rgg-editor.cjs.production.min.js.map
